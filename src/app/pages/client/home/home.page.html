<ion-header>
  <ion-toolbar class="header-toolbar">
    <div class="header-container">
      <!-- üîπ Logo -->
      <ion-title class="logo">E-Shop</ion-title>

      <!-- üîπ Barre de recherche -->
      <ion-searchbar
        placeholder="Rechercher un produit..."
        debounce="150"
        (ionInput)="onSearch($event)"
        class="search-bar"
      ></ion-searchbar>

      <!-- üîπ Ic√¥nes √† droite -->
      <div class="header-icons">
        <!-- Panier -->
        <ion-button routerLink="/client/cart" fill="clear" class="cart-button">
          <ion-icon name="cart-outline"></ion-icon>
          <ion-badge *ngIf="cartCount > 0" class="cart-badge">{{ cartCount }}</ion-badge>
        </ion-button>

        <!-- ‚úÖ Si connect√© -->
        <ng-container *ngIf="isLoggedIn; else notConnected">
          <ion-button routerLink="/client/profile" fill="clear">
            <ion-icon name="person-outline"></ion-icon>
          </ion-button>

          <ion-button fill="clear" color="danger" (click)="logout()">
            <ion-icon name="log-out-outline"></ion-icon>
          </ion-button>
        </ng-container>

        <!-- üö™ Sinon : bouton Connexion -->
        <ng-template #notConnected>
          <ion-button fill="clear" routerLink="/login">
            <ion-icon name="log-in-outline"></ion-icon>
          </ion-button>
        </ng-template>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<!-- üîπ Contenu principal -->
<ion-content class="home-content">
  <div class="section" *ngFor="let cat of categories">
    <div class="section-header">
      <h2>{{ cat.name }}</h2>
    </div>

    <div class="products-row" *ngIf="filteredProductsByCategory[cat.slug]?.length; else noResult">
      <div
        class="product-card"
        *ngFor="let p of filteredProductsByCategory[cat.slug]"
        (click)="goToDetails(p)"
      >
        <img [src]="p.imageUrl || 'assets/img-placeholder.png'" alt="{{ p.name }}" />
        <p class="name">{{ p.name }}</p>
        <p class="price">{{ p.price }} DT</p>
      </div>
    </div>

    <ng-template #noResult>
      <p class="no-products">Aucun produit trouv√© dans cette cat√©gorie</p>
    </ng-template>
  </div>
</ion-content>
